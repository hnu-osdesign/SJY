<!DOCTYPE html> <html lang="zh"> <head> <meta charset="utf-8"/><link rel="shortcut icon" href="https://www.mdeditor.com/images/logos/favicon.ico" type="image/x-icon"/> </head> <body><h1 id="h1-uart"><a name="UART" class="reference-link"></a><span class="header-link octicon octicon-link"></span>UART</h1><p>通用异步收发传输器（Universal Asynchronous Receiver/Transmitter)，通常称作UART，是一种用于异步通信的通用串行数据总线。该总线双向通信，可以实现全双工传输和接收。它将要传输的资料在串行通信与并行通信之间加以转换。作为把并行输入信号转成串行输出信号的芯片，UART通常被集成于其他通讯接口的连结上。<br>具体实物表现为独立的模块化芯片，或作为集成于微处理器中的周边设备。 </p><blockquote> <p>一般是RS-232C规格的，与类似Maxim的MAX232之类的标准信号幅度变换芯片进行搭配，作为连接外部设备的接口。在UART上追加同步方式的序列信号变换电路的产品，被称为USART(Universal Synchronous Asynchronous Receiver Transmitter)。</p> </blockquote> <p>UART作为异步串口通信协议的一种，工作原理是将传输数据的每个字符一位接一位地传输。<br>其中各位的意义如下：<br>起始位：先发出一个逻辑“0”的信号，表示传输字符的开始。<br>资料位：紧接着起始位之后。资料位的个数可以是4、5、6、7、8等，构成一个字符。通常采用ASCII码。从最低位开始传送，靠时钟定位。<br>奇偶校验位：资料位加上这一位后，使得“1”的位数应为偶数（偶校验）或奇数（奇校验），以此来校验资料传送的正确性。<br>停止位：它是一个字符数据的结束标志。可以是1位、1.5位、2位的高电平。由于数据是在传输线上定时的，并且每一个设备有其自己的时钟，很可能在通信中两台设备间出现了小小的不同步。因此停止位不仅仅是表示传输的结束，并且提供计算机校正时钟同步的机会。适用于停止位的位数越多，不同时钟同步的容忍程度越大，但是数据传输率同时也越慢。<br>空闲位：处于逻辑“1”状态，表示当前线路上没有资料传送。<br>波特率：是衡量资料传送速率的指标。表示每秒钟传送的符号数（symbol）。一个符号代表的信息量（比特数）与符号的阶数有关。例如传输使用256阶符号，每8bit代表一个符号，资料传送速率为120字符/秒，则波特率就是120baud，比特率是120*8=960bit/s。这两者的概念很容易搞错。 </p><h3 id="h3-u57FAu672Cu7ED3u6784"><a name="基本结构" class="reference-link"></a><span class="header-link octicon octicon-link"></span>基本结构</h3><p>（1）输出缓冲寄存器，它接收CPU从数据总线上送来的并行数据，并加以保存。<br>（2）输出移位寄存器，它接收从输出缓冲器送来的并行数据，以发送时钟的速率把数据逐位移出，即将并行数据转换为串行数据输出。<br>（3）输入移位寄存器，它以接收时钟的速率把出现在串行数据输入线上的数据逐位移入，当数据装满后，并行送往输入缓冲寄存器，即将串行数据转换成并行数据。<br>（4）输入缓冲寄存器，它从输入移位寄存器中接收并行数据，然后由CPU取走。<br>（5）控制寄存器，它接收CPU送来的控制字，由控制字的内容，决定通信时的传输方式以及数据格式等。例如采用异步方式还是同步方式，数据字符的位数，有无奇偶校验，是奇校验还是偶校验，停止位的位数等参数。<br>（6）状态寄存器。状态寄存器中存放着接口的各种状态信息，例如输出缓冲区是否空，输入字符是否准备好等。在通信过程中，当符合某种状态时，接口中的状态检测逻辑将状态寄存器的相应位置“1”，以便让CPU查询。 </p><h3 id="h3-u5DE5u4F5Cu539Fu7406"><a name="工作原理" class="reference-link"></a><span class="header-link octicon octicon-link"></span>工作原理</h3><h4 id="h4-u53D1u9001u63A5u6536"><a name="发送接收" class="reference-link"></a><span class="header-link octicon octicon-link"></span>发送接收</h4><p>发送逻辑对从发送FIFO读取的数据执行“并→串”转换。控制逻辑输出起始位在先的串行位流，并且根据控制寄存器中已编程的配置，后面紧跟着数据位（注意：最低位LSB先输出）、奇偶校验位和停止位。<br>在检测到一个有效的起始脉冲后，接收逻辑对接收到的位流执行“串→并”转换。此外还会对溢出错误、奇偶校验错误、帧错误和线中止（line-break）错误进行检测，并将检测到的状态附加到被写入接收FIFO的数据中。 </p><h4 id="h4-u6CE2u7279u7387u4EA7u751F"><a name="波特率产生" class="reference-link"></a><span class="header-link octicon octicon-link"></span>波特率产生</h4><p>波特率除数（baud-rate divisor）是一个22位数，它由16位整数和6位小数组成。波特率发生器使用这两个值组成的数字来决定位周期。通过带有小数波特率的除法器，在足够高的系统时钟速率下，UART可以产生所有标准的波特率，而误差很小。</p> <h4 id="h4-u6570u636Eu6536u53D1"><a name="数据收发" class="reference-link"></a><span class="header-link octicon octicon-link"></span>数据收发</h4><p>发送时，数据被写入发送FIFO。如果UART被使能，则会按照预先设置好的参数（波特率、数据位、停止位、校验位等）开始发送数据，一直到发送FIFO中没有数据。一旦向发送FIFO写数据（如果FIFO 未空），UART的忙标志位BUSY就有效，并且在发送数据期间一直保持有效。BUSY位仅在发送FIFO为空，且已从移位寄存器发送最后一个字符，包括停止位时才变无效。即 UART不再使能，它也可以指示忙状态。BUSY位的相关库函数是UARTBusy()。<br>在UART接收器空闲时，如果数据输入变成“低电平”，即接收到了起始位，则接收计数器开始运行，并且数据在Baud16的第8个周期被采样。如果Rx在Baud16的第8周期仍然为低电平，则起始位有效，否则会被认为是错误的起始位并将其忽略。<br>如果起始位有效，则根据数据字符被编程的长度，在Baud16的每第16个周期（即一个位周期之后）对连续的数据位进行采样。如果奇偶校验模式使能，则还会检测奇偶校验位。<br>最后，如果Rx为高电平，则有效的停止位被确认，否则发生帧错误。当接收到一个完整的字符时，将数据存放在接收FIFO中。 </p><h4 id="h4-u4E2Du65ADu63A7u5236"><a name="中断控制" class="reference-link"></a><span class="header-link octicon octicon-link"></span>中断控制</h4><p>出现以下情况时，可使UART产生中断：<br>FIFO溢出错误<br>线中止错误（line-break，即Rx信号一直为0的状态，包括校验位和停止位在内）<br>奇偶校验错误<br>帧错误（停止位不为1）<br>接收超时（接收FIFO已有数据但未满，而后续数据长时间不来）<br>发送<br>接收<br>由于所有中断事件在发送到中断控制器之前会一起进行“或运算”操作，所以任意时刻 UART只能向中断产生一个中断请求。通过查询中断状态函数UARTIntStatus()，软件可以在同一个中断服务函数里处理多个中断事件（多个并列的if语句）。 </p><h4 id="h4-fifo-"><a name="FIFO 操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>FIFO 操作</h4><p>FIFO是“First-In First-Out”的缩写，意为“先进先出”，是一种常见的队列操作。 Stellaris系列ARM的UART模块包含有2个16字节的FIFO：一个用于发送，另一个用于接收。可以将两个FIFO分别配置为以不同深度触发中断。可供选择的配置包括：1/8、1/4、1/2、3/4 和7/8深度。例如，如果接收FIFO选择1/4，则在UART接收到4个数据时产生接收中断。<br>发送FIFO的基本工作过程：只要有数据填充到发送FIFO里，就会立即启动发送过程。由于发送本身是个相对缓慢的过程，因此在发送的同时其它需要发送的数据还可以继续填充到发送FIFO里。当发送FIFO被填满时就不能再继续填充了，否则会造成数据丢失，此时只能等待。这个等待并不会很久，以9600的波特率为例，等待出现一个空位的时间在1ms 上下。发送FIFO会按照填入数据的先后顺序把数据一个个发送出去，直到发送FIFO全空时为止。已发送完毕的数据会被自动清除，在发送FIFO里同时会多出一个空位。<br>接收FIFO的基本工作过程：当硬件逻辑接收到数据时，就会往接收FIFO里填充接收到的数据。程序应当及时取走这些数据，数据被取走也是在接收FIFO里被自动删除的过程，因此在接收FIFO里同时会多出一个空位。如果在接收FIFO里的数据未被及时取走而造成接收FIFO已满，则以后再接收到数据时因无空位可以填充而造成数据丢失。<br>收发FIFO主要是为了解决UART收发中断过于频繁而导致CPU效率不高的问题而引入的。在进行UART通信时，中断方式比轮询方式要简便且效率高。但是，如果没有收发FIFO，则每收发一个数据都要中断处理一次，效率仍然不够高。如果有了收发FIFO，则可以在连续收发若干个数据（可多至14个）后才产生一次中断然后一并处理，这就大大提高了收发效率。<br>完全不必要担心FIFO机制可能带来的数据丢失或得不到及时处理的问题，因为它已经帮你想到了收发过程中存在的任何问题，只要在初始化配置UART后，就可以放心收发了， FIFO和中断例程会自动搞定一切。 </p><h4 id="h4-u56DEu73AFu64CDu4F5C"><a name="回环操作" class="reference-link"></a><span class="header-link octicon octicon-link"></span>回环操作</h4><p>UART可以进入一个内部回环（Loopback）模式，用于诊断或调试。在回环模式下，从Tx 上发送的数据将被Rx输入端接收。</p> <h4 id="h4-u4E32u884Cu7EA2u5916u534Fu8BAE"><a name="串行红外协议" class="reference-link"></a><span class="header-link octicon octicon-link"></span>串行红外协议</h4><p>在某些Stellaris系列ARM芯片里，UART还包含一个IrDA串行红外（SIR）编码器/解码器模块。IrDA SIR模块的作用是在异步UART数据流和半双工串行SIR接口之间进行转换。片上不会执行任何模拟处理操作。SIR模块的任务就是要给UART提供一个数字编码输出和一个解码输入。UART信号管脚可以和一个红外收发器连接以实现IrDA SIR物理层连接。</p> </body> </html>
![iMage](https://github.com/hnu-osdesign/SJY/blob/main/3.png)
